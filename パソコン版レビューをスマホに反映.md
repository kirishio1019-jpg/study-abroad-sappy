# パソコン版のレビューをスマホに反映

## 🔍 問題

パソコン版（https://study-abroad-sappy.vercel.app/）で投稿されたレビューが、スマホ版に反映されていない。

## ✅ 修正内容

### 1. ページ読み込み時の自動キャッシュクリア

- ページ読み込み時に、30秒以上経過したキャッシュは自動的にクリア
- これにより、パソコンで投稿されたレビューがスマホでも確実に反映される

### 2. 確実なSupabaseからのデータ取得

- キャッシュをクリアした後、必ずSupabaseから最新データを取得
- localStorageの古いデータは無視して、Supabaseの最新データを優先

### 3. タイムスタンプによる更新判定

- 最後にデータを取得した時刻を記録
- 30秒以上経過した場合は、自動的にSupabaseから最新データを取得

## 📱 確認方法

### 1. スマホでアプリを開く

1. **ブラウザのキャッシュをクリア**（推奨）
   - iOS Safari: 設定 → Safari → 「履歴とWebサイトデータを消去」
   - Android Chrome: 設定 → プライバシーとセキュリティ → 「閲覧履歴データを消去」

2. **アプリを開く**
   - https://study-abroad-sappy.vercel.app/ にアクセス

3. **ページをリロード**
   - 画面を下に引っ張って更新
   - または、ブラウザのリロードボタンをタップ

### 2. コンソールログを確認

以下のログが表示されることを確認：

```
🔄 Clearing cache and fetching fresh data from Supabase...
🔄 Fetching reviews from getAllReviews()...
✅ Loaded X reviews from Supabase
✅ Cached X reviews to localStorage
📱 Home page: Loaded X reviews
✅ Setting X reviews to state
```

### 3. レビューが表示されるか確認

- ホームページの「最新レビュー」セクションにレビューが表示されるか
- 検索ページでもレビューが表示されるか

## 🔧 技術的な仕組み

1. **ページ読み込み時**:
   - 最後にデータを取得した時刻をチェック
   - 30秒以上経過している場合は、キャッシュをクリア

2. **データ取得**:
   - キャッシュをクリア後、Supabaseから最新データを取得
   - 取得したデータをlocalStorageに保存（次回の高速化のため）

3. **表示**:
   - 取得したデータを状態にセット
   - 最新順（IDの降順）でソートして表示

## 💡 次のステップ

1. **デプロイの確認**: Vercelでデプロイが完了しているか確認
2. **スマホで確認**: ブラウザキャッシュをクリアしてから、アプリを開く
3. **レビューが表示されるか確認**: パソコンで投稿したレビューがスマホでも表示されるか

## ⚠️ 注意点

- 初回読み込み時は、必ずSupabaseからデータを取得します
- 30秒以内に再度開いた場合は、キャッシュを使用します（高速化のため）
- 確実に最新データを取得したい場合は、ブラウザのキャッシュをクリアしてください

